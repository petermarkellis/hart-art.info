{{ define "header" }}
  <!-- About page - white background, no large header -->
  <header class="bg-white">
    {{ partial "site-navigation.html" . }}
  </header>
{{ end }}

{{ define "main" }}
{{ $aboutPage := .Page }}

{{/* Read default _index.md for nested contact_info structure and other fields */}}
{{ $defaultAboutParams := dict }}
{{ $defaultFrontPath := "content/about/_index.md" }}
{{ if fileExists $defaultFrontPath }}
  {{ $raw := readFile $defaultFrontPath }}
  {{ $front := replaceRE `(?s)^---\s*\n(.*?)\n---.*$` "$1" $raw }}
  {{ $defaultAboutParams = $front | transform.Unmarshal }}
{{ end }}

<div class="flex flex-column flex-row-l bg-white about-page-container" style="width: 100%;">
  <!-- Left Column - Portrait and Contact Info -->
  <aside class="w-100 w-40-l pa3 pa4-l bg-white about-sidebar" style="border-right: 1px solid #e5e5e5; align-self: flex-start;">
    {{ if $aboutPage.Params.image }}
      <div class="mb4">
        <img src="{{ $aboutPage.Params.image }}" alt="{{ $aboutPage.Title }}" class="w-100" style="max-width: 100%; height: auto; display: block;" />
      </div>
    {{ end }}

    <div class="f6 f5-ns lh-copy black-80 mb4" style="font-family: 'Inter', sans-serif;">
      {{/* Support both nested contact_info object and flat structure for backward compatibility */}}
      {{ $contactInfo := $aboutPage.Params.contact_info }}
      {{/* If language-specific page doesn't have nested structure, check default _index.md */}}
      {{ if not $contactInfo }}
        {{ if $defaultAboutParams }}
          {{ if $defaultAboutParams.contact_info }}
            {{ $contactInfo = $defaultAboutParams.contact_info }}
          {{ end }}
        {{ end }}
      {{ end }}
      
      {{ $email := "" }}
      {{ $addressLine1 := "" }}
      {{ $addressLine2 := "" }}
      {{ $addressLine3 := "" }}
      {{ $contactButtonText := "" }}
      {{ $copyrightText := "" }}
      
      {{ if $contactInfo }}
        {{ $email = $contactInfo.email }}
        {{ $addressLine1 = $contactInfo.address_line1 }}
        {{ $addressLine2 = $contactInfo.address_line2 }}
        {{ $addressLine3 = $contactInfo.address_line3 }}
        {{ $contactButtonText = $contactInfo.contact_button_text }}
        {{ $copyrightText = $contactInfo.copyright_text }}
      {{ else }}
        {{/* Fallback to flat structure from language-specific page or default */}}
        {{ $email = $aboutPage.Params.email }}
        {{ $addressLine1 = $aboutPage.Params.address_line1 }}
        {{ $addressLine2 = $aboutPage.Params.address_line2 }}
        {{ $addressLine3 = $aboutPage.Params.address_line3 }}
        {{ $contactButtonText = $aboutPage.Params.contact_button_text }}
        {{ $copyrightText = $aboutPage.Params.copyright_text }}
        {{/* If still empty, try default file */}}
        {{ if and (not $email) $defaultAboutParams }}
          {{ $email = $defaultAboutParams.email }}
        {{ end }}
        {{ if and (not $addressLine1) $defaultAboutParams }}
          {{ $addressLine1 = $defaultAboutParams.address_line1 }}
        {{ end }}
        {{ if and (not $addressLine2) $defaultAboutParams }}
          {{ $addressLine2 = $defaultAboutParams.address_line2 }}
        {{ end }}
        {{ if and (not $addressLine3) $defaultAboutParams }}
          {{ $addressLine3 = $defaultAboutParams.address_line3 }}
        {{ end }}
        {{ if and (not $contactButtonText) $defaultAboutParams }}
          {{ $contactButtonText = $defaultAboutParams.contact_button_text }}
        {{ end }}
        {{ if and (not $copyrightText) $defaultAboutParams }}
          {{ $copyrightText = $defaultAboutParams.copyright_text }}
        {{ end }}
      {{ end }}
      
      {{ with $addressLine1 }}<p class="mb0">{{ . }}</p>{{ end }}
      {{ with $addressLine2 }}<p class="mb0">{{ . }}</p>{{ end }}
      {{ with $addressLine3 }}<p class="mb0">{{ . }}</p>{{ end }}
      <p class="mt3 mb0">
        {{ if $copyrightText }}
          {{ $copyrightText }}
        {{ else }}
          Â© {{ now.Format "2006" }} Mark Hartzheim
        {{ end }}
      </p>
    </div>

    {{ if $email }}
      <a href="mailto:{{ $email }}" class="dib bg-black white pa3 pa4-ns no-underline hover-bg-black-80 nav-link" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em; transition: background-color 0.2s;">
        {{ $contactButtonText | default "CONTACT THE ARTIST" }}
      </a>
    {{ end }}
  </aside>

  <!-- Right Column - About Content -->
  <main class="w-100 w-60-l pa3 pa4-l bg-white pb6" style="flex: 1;">
    <h1 class="f4 f3-ns fw6 mb4 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
      {{ $aboutPage.Title }}
    </h1>

    {{/* Description/Content - language-specific */}}
    {{ $currentLang := .Site.Language.Lang }}
    {{ $description := "" }}
    
    {{/* Get language-specific description */}}
    {{ if eq $currentLang "de" }}
      {{ $description = $aboutPage.Params.body_de }}
    {{ else }}
      {{ $description = $aboutPage.Params.body_en }}
    {{ end }}
    
    {{/* Fallback to default file if not found in language-specific page */}}
    {{ if $defaultAboutParams }}
      {{ if not $description }}
        {{ if eq $currentLang "de" }}
          {{ $description = $defaultAboutParams.body_de }}
        {{ else }}
          {{ $description = $defaultAboutParams.body_en }}
        {{ end }}
      {{ end }}
    {{ end }}
    
    {{/* Fallback to Content if language-specific fields are empty (for backward compatibility) */}}
    {{ $useContentFallback := false }}
    {{ if not $description }}
      {{ $description = $aboutPage.Content }}
      {{ $useContentFallback = true }}
    {{ end }}
    
    {{ if $description }}
      <div class="f6 f5-ns lh-copy black-80 mb5" style="font-family: 'Inter', sans-serif; max-width: 800px;">
        {{ if $useContentFallback }}
          {{ $description }}
        {{ else }}
          {{ $description | markdownify }}
        {{ end }}
      </div>
    {{ end }}

    {{/* Buying Art and Commissioning Section */}}
    {{ $showBuyingArt := $aboutPage.Params.show_buying_art }}
    {{ if not (isset $aboutPage.Params "show_buying_art") }}
      {{ $showBuyingArt = true }}
    {{ end }}
    {{ if $defaultAboutParams }}
      {{ if not (isset $aboutPage.Params "show_buying_art") }}
        {{ if isset $defaultAboutParams "show_buying_art" }}
          {{ $showBuyingArt = $defaultAboutParams.show_buying_art }}
        {{ end }}
      {{ end }}
    {{ end }}
    
    {{ if $showBuyingArt }}
      {{ $currentLang := .Site.Language.Lang }}
      {{ $buyingArtTitle := "" }}
      {{ $buyingArtDescription := "" }}
      
      {{/* Get language-specific fields */}}
      {{ if eq $currentLang "de" }}
        {{ $buyingArtTitle = $aboutPage.Params.buying_art_title_de }}
        {{ $buyingArtDescription = $aboutPage.Params.buying_art_description_de }}
      {{ else }}
        {{ $buyingArtTitle = $aboutPage.Params.buying_art_title_en }}
        {{ $buyingArtDescription = $aboutPage.Params.buying_art_description_en }}
      {{ end }}
      
      {{/* Fallback to default file if not found in language-specific page */}}
      {{ if $defaultAboutParams }}
        {{ if not $buyingArtTitle }}
          {{ if eq $currentLang "de" }}
            {{ $buyingArtTitle = $defaultAboutParams.buying_art_title_de }}
          {{ else }}
            {{ $buyingArtTitle = $defaultAboutParams.buying_art_title_en }}
          {{ end }}
        {{ end }}
        {{ if not $buyingArtDescription }}
          {{ if eq $currentLang "de" }}
            {{ $buyingArtDescription = $defaultAboutParams.buying_art_description_de }}
          {{ else }}
            {{ $buyingArtDescription = $defaultAboutParams.buying_art_description_en }}
          {{ end }}
        {{ end }}
      {{ end }}
      
      {{ if or $buyingArtTitle $buyingArtDescription }}
        <div class="f6 f5-ns lh-copy black-80 mb5" style="font-family: 'Inter', sans-serif; max-width: 800px;">
          {{ if $buyingArtTitle }}
            <h2 class="f5 f4-ns fw6 mb3 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
              {{ $buyingArtTitle | upper }}
            </h2>
          {{ end }}
          {{ if $buyingArtDescription }}
            <div class="mb4">
              {{ $buyingArtDescription | markdownify }}
            </div>
          {{ end }}
        </div>
      {{ end }}
    {{ end }}
  </main>
</div>

<style>
  /* Ensure about page container doesn't interfere with sticky */
  .about-page-container {
    overflow: visible !important;
  }
  
  /* Override main overflow for about page to allow sticky */
  main:has(.about-page-container) {
    overflow-x: visible !important;
    overflow-y: visible !important;
  }
  
  /* Fallback for browsers that don't support :has() */
  @supports not selector(:has(*)) {
    main {
      overflow-x: visible !important;
      overflow-y: visible !important;
    }
  }
  
  /* Sticky sidebar on desktop */
  @media (min-width: 60em) {
    .about-sidebar {
      position: -webkit-sticky !important;
      position: sticky !important;
      top: 0 !important;
      max-height: 100vh !important;
      overflow-y: auto !important;
      align-self: flex-start !important;
    }
  }
  
  /* Responsive layout for about page */
  @media (max-width: 60em) {
    .about-sidebar {
      border-right: none !important;
      border-bottom: 1px solid #e5e5e5;
      position: relative !important;
      align-self: stretch !important;
      max-height: none !important;
      overflow-y: visible !important;
    }
  }
</style>
{{ end }}

