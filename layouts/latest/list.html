{{ define "header" }}
  <!-- Latest news listing page - white background, no large header -->
  <header class="bg-white">
    {{ partial "site-navigation.html" . }}
  </header>
{{ end }}

{{ define "main" }}
  <section class="pa4 pa5-ns bg-white">
    <h1 class="f6 f5-ns fw6 mb4 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">LATEST NEWS</h1>
    <div class="news-list">
      {{/* Try multiple methods to get latest news pages - filtered by current language */}}
      {{ $currentLang := .Site.Language.Lang }}
      {{ $latestNews := slice }}
      
      {{/* Method 1: Try RegularPages (already filtered by language) - includes drafts if running with -D flag */}}
      {{ $latestNews = where .Site.RegularPages "Section" "latest" }}
      {{/* Also check AllPages to catch any that might be filtered out */}}
      {{ $allPagesLatest := where .Site.AllPages "Section" "latest" }}
      {{ $allPagesLatest = where $allPagesLatest "Lang" $currentLang }}
      {{ $allPagesLatest = where $allPagesLatest "IsNode" false }}
      {{ $allPagesLatest = where $allPagesLatest "Kind" "!=" "section" }}
      {{ if gt (len $allPagesLatest) (len $latestNews) }}
        {{ $latestNews = $allPagesLatest }}
      {{ end }}
      
      {{/* Method 2: Try AllPages and filter by language to include future-dated pages */}}
      {{ $allLatestNews := where .Site.AllPages "Section" "latest" }}
      {{ $allLatestNews = where $allLatestNews "Lang" $currentLang }}
      {{ if gt (len $allLatestNews) (len $latestNews) }}
        {{ $latestNews = $allLatestNews }}
      {{ end }}
      
      {{/* Method 3: Try section pages */}}
      {{ if not $latestNews }}
        {{ $latestSection := .Site.GetPage "section" "latest" }}
        {{ if $latestSection }}
          {{ $latestNews = where $latestSection.Pages "Lang" $currentLang }}
        {{ end }}
      {{ end }}
      
      {{/* Ensure all items are in the current language */}}
      {{ $latestNews = where $latestNews "Lang" $currentLang }}
      
      {{/* Filter out the section index page (the /latest/ listing page itself) */}}
      {{/* Use where filters to maintain page collection type */}}
      {{ $latestNews = where $latestNews "IsNode" false }}
      {{ $latestNews = where $latestNews "Kind" "!=" "section" }}
      
      {{/* Sort by date (newest first) - NO LIMIT, show all entries */}}
      {{ if $latestNews }}
        {{/* Convert to proper page collection and sort by date */}}
        {{ $latestNews = $latestNews.ByDate.Reverse }}
      {{ else }}
        {{ $latestNews = slice }}
      {{ end }}
      {{ range $latestNews }}
        <a href="{{ .RelPermalink }}" class="db no-underline news-item" style="border-bottom: 1px solid #e5e5e5; padding: 1rem; display: flex; justify-content: space-between; align-items: center;">
          <div class="flex-auto">
            <h3 class="f6 f5-ns fw4 black-90 mb0" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em; margin: 0;">{{ .Title }}</h3>
          </div>
          {{ if not .Date.IsZero }}
            <div class="ml3 ml4-ns" style="flex-shrink: 0;">
              <span class="f7 f6-ns black-60" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em; white-space: nowrap;">
                {{ .Date.Format "2 January 2006" | upper }}
              </span>
            </div>
          {{ end }}
        </a>
      {{ end }}
      {{ if not $latestNews }}
        <p class="f6 f5-ns black-70" style="font-family: 'Inter', sans-serif;">No news items yet.</p>
      {{ end }}
    </div>
  </section>

  <style>
    .news-item:hover {
      background-color: #fafafa;
    }
  </style>
{{ end }}

