{{ define "header" }}
  <!-- Latest news pages - white background, no large header -->
  <header class="bg-white">
    {{ partial "site-navigation.html" . }}
  </header>
{{ end }}

{{ define "main" }}
<div class="ph2 pv4 ph4-ns pv5-ns bg-white" style="max-width: 800px; margin: 0 auto;">
  <!-- News Title -->
  <h1 class="f4 f3-ns fw6 mb4 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
    {{ .Title | upper }}
  </h1>

  {{/* Determine creation date, with fallbacks to other language */}}
  {{ $creationDate := .Date }}
  {{ if or (not $creationDate) $creationDate.IsZero }}
    {{ range .Translations }}
      {{ if not .Date.IsZero }}
        {{ $creationDate = .Date }}
        {{ break }}
      {{ end }}
    {{ end }}
  {{ end }}
  {{ if or (not $creationDate) $creationDate.IsZero }}
    {{ $otherLang := "en" }}
    {{ if eq .Site.Language.Lang "en" }}
      {{ $otherLang = "de" }}
    {{ end }}
    {{ if and $.File $.File.LogicalName }}
      {{ $baseName := strings.TrimSuffix (printf ".%s" .Lang) $.File.LogicalName }}
      {{ $baseName = strings.TrimSuffix ".md" $baseName }}
      {{ range where $.Site.AllPages "Section" "latest" }}
        {{ if and .File (eq .Lang $otherLang) }}
          {{ $otherBaseName := strings.TrimSuffix (printf ".%s" $otherLang) .File.LogicalName }}
          {{ $otherBaseName = strings.TrimSuffix ".md" $otherBaseName }}
          {{ if eq $otherBaseName $baseName }}
            {{ if not .Date.IsZero }}
              {{ $creationDate = .Date }}
              {{ break }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ if and $creationDate (not $creationDate.IsZero) }}
    {{ $publishedLabel := "PUBLISHED ON:" }}
    {{ if eq .Site.Language.Lang "de" }}
      {{ $publishedLabel = "VERÖFFENTLICHT AM:" }}
    {{ end }}
    <div class="f7 f6-ns mb4 black-60" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
      <strong>{{ $publishedLabel }}</strong> {{ $creationDate.Format "2 January 2006" | upper }}
    </div>
  {{ end }}

  {{/* Determine exhibition dates (start and end), also fall back to other language if missing */}}
  {{ $exhibitionStartDateRaw := "" }}
  {{ $exhibitionEndDateRaw := "" }}
  
  {{/* Get start date from current language first */}}
  {{ if isset .Params "exhibition_start_date" }}
    {{ if .Params.exhibition_start_date }}
      {{ $exhibitionStartDateRaw = .Params.exhibition_start_date }}
    {{ end }}
  {{ end }}
  {{/* Get end date from current language first */}}
  {{ if isset .Params "exhibition_end_date" }}
    {{ if .Params.exhibition_end_date }}
      {{ $exhibitionEndDateRaw = .Params.exhibition_end_date }}
    {{ end }}
  {{ end }}
  {{/* Legacy support: if no start/end dates, check old exhibition_date field */}}
  {{ if not $exhibitionStartDateRaw }}
    {{ if isset .Params "exhibition_date" }}
      {{ if .Params.exhibition_date }}
        {{ $exhibitionStartDateRaw = .Params.exhibition_date }}
      {{ end }}
    {{ end }}
  {{ end }}
  
  {{/* Fallback to translations if missing */}}
  {{ if or (not $exhibitionStartDateRaw) (not $exhibitionEndDateRaw) }}
    {{ range .Translations }}
      {{ if and (not $exhibitionStartDateRaw) (isset .Params "exhibition_start_date") }}
        {{ if .Params.exhibition_start_date }}
          {{ $exhibitionStartDateRaw = .Params.exhibition_start_date }}
        {{ end }}
      {{ end }}
      {{ if and (not $exhibitionEndDateRaw) (isset .Params "exhibition_end_date") }}
        {{ if .Params.exhibition_end_date }}
          {{ $exhibitionEndDateRaw = .Params.exhibition_end_date }}
        {{ end }}
      {{ end }}
      {{/* Legacy support: check old exhibition_date field in translations */}}
      {{ if and (not $exhibitionStartDateRaw) (isset .Params "exhibition_date") }}
        {{ if .Params.exhibition_date }}
          {{ $exhibitionStartDateRaw = .Params.exhibition_date }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  
  {{/* Fallback to manual filename matching if still missing */}}
  {{ if or (not $exhibitionStartDateRaw) (not $exhibitionEndDateRaw) }}
    {{ $otherLang := "en" }}
    {{ if eq .Site.Language.Lang "en" }}
      {{ $otherLang = "de" }}
    {{ end }}
    {{ if and $.File $.File.LogicalName }}
      {{ $baseName := strings.TrimSuffix (printf ".%s" .Lang) $.File.LogicalName }}
      {{ $baseName = strings.TrimSuffix ".md" $baseName }}
      {{ range where $.Site.AllPages "Section" "latest" }}
        {{ if and .File (eq .Lang $otherLang) }}
          {{ $otherBaseName := strings.TrimSuffix (printf ".%s" $otherLang) .File.LogicalName }}
          {{ $otherBaseName = strings.TrimSuffix ".md" $otherBaseName }}
          {{ if eq $otherBaseName $baseName }}
            {{ if and (not $exhibitionStartDateRaw) (isset .Params "exhibition_start_date") }}
              {{ if .Params.exhibition_start_date }}
                {{ $exhibitionStartDateRaw = .Params.exhibition_start_date }}
              {{ end }}
            {{ end }}
            {{ if and (not $exhibitionEndDateRaw) (isset .Params "exhibition_end_date") }}
              {{ if .Params.exhibition_end_date }}
                {{ $exhibitionEndDateRaw = .Params.exhibition_end_date }}
              {{ end }}
            {{ end }}
            {{/* Legacy support: check old exhibition_date field */}}
            {{ if and (not $exhibitionStartDateRaw) (isset .Params "exhibition_date") }}
              {{ if .Params.exhibition_date }}
                {{ $exhibitionStartDateRaw = .Params.exhibition_date }}
              {{ end }}
            {{ end }}
            {{ break }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{/* Format and display exhibition dates */}}
  {{ $exhibitionStartDate := "" }}
  {{ $exhibitionEndDate := "" }}
  
  {{ if $exhibitionStartDateRaw }}
    {{ $parsedStart := time $exhibitionStartDateRaw }}
    {{ if and $parsedStart (not $parsedStart.IsZero) }}
      {{ $exhibitionStartDate = $parsedStart }}
    {{ end }}
  {{ end }}
  
  {{ if $exhibitionEndDateRaw }}
    {{ $parsedEnd := time $exhibitionEndDateRaw }}
    {{ if and $parsedEnd (not $parsedEnd.IsZero) }}
      {{ $exhibitionEndDate = $parsedEnd }}
    {{ end }}
  {{ end }}
  
  {{ if $exhibitionStartDate }}
    {{/* Helper function to get ordinal suffix */}}
    {{ $day := $exhibitionStartDate.Day }}
    {{ $ordinal := "th" }}
    {{ $mod10 := mod $day 10 }}
    {{ $mod100 := mod $day 100 }}
    {{ if and (ge $mod100 11) (le $mod100 13) }}
      {{ $ordinal = "th" }}
    {{ else if eq $mod10 1 }}
      {{ $ordinal = "st" }}
    {{ else if eq $mod10 2 }}
      {{ $ordinal = "nd" }}
    {{ else if eq $mod10 3 }}
      {{ $ordinal = "rd" }}
    {{ end }}
    {{ $startFormatted := printf "%d%s %s %d" $day $ordinal ($exhibitionStartDate.Format "January") $exhibitionStartDate.Year }}
    
    {{ $endFormatted := "" }}
    {{ if $exhibitionEndDate }}
      {{ $endDay := $exhibitionEndDate.Day }}
      {{ $endOrdinal := "th" }}
      {{ $endMod10 := mod $endDay 10 }}
      {{ $endMod100 := mod $endDay 100 }}
      {{ if and (ge $endMod100 11) (le $endMod100 13) }}
        {{ $endOrdinal = "th" }}
      {{ else if eq $endMod10 1 }}
        {{ $endOrdinal = "st" }}
      {{ else if eq $endMod10 2 }}
        {{ $endOrdinal = "nd" }}
      {{ else if eq $endMod10 3 }}
        {{ $endOrdinal = "rd" }}
      {{ end }}
      {{ $endFormatted = printf "%d%s %s %d" $endDay $endOrdinal ($exhibitionEndDate.Format "January") $exhibitionEndDate.Year }}
    {{ end }}
    
    {{ $exhibitionLabel := "EXHIBITION DATE:" }}
    {{ $fromText := "from" }}
    {{ $toText := "to" }}
    {{ if eq .Site.Language.Lang "de" }}
      {{ $exhibitionLabel = "AUSSTELLUNGSDATUM:" }}
      {{ $fromText = "vom" }}
      {{ $toText = "bis" }}
    {{ end }}
    <div class="f7 f6-ns mb4 black-60" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
      <strong>{{ $exhibitionLabel }}</strong> 
      {{ if $endFormatted }}
        {{ $fromText }} {{ $startFormatted | upper }} {{ $toText }} {{ $endFormatted | upper }}
      {{ else }}
        {{ $startFormatted | upper }}
      {{ end }}
    </div>
  {{ end }}

  <!-- News Description -->
  {{ $description := "" }}
  {{/* Always prioritize current language's content first */}}
  {{ if isset .Params "description" }}
    {{ if and .Params.description (ne .Params.description "") }}
      {{ $description = .Params.description }}
    {{ end }}
  {{ end }}
  {{/* Only fallback to other language if current language has no description */}}
  {{ if or (not $description) (eq $description "") }}
    {{/* Try using Hugo's Translations feature first */}}
    {{ range .Translations }}
      {{ if isset .Params "description" }}
        {{ if and .Params.description (ne .Params.description "") }}
          {{ $description = .Params.description }}
          {{ break }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{/* Fallback: manually find by matching filename */}}
    {{ if or (not $description) (eq $description "") }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{/* Extract base filename without language suffix */}}
      {{ $baseName := strings.TrimSuffix (printf ".%s" .Lang) .File.LogicalName }}
      {{ $baseName = strings.TrimSuffix ".md" $baseName }}
      {{/* Find the other language version by matching base filename */}}
      {{ range where $.Site.AllPages "Section" "latest" }}
        {{ if and .File (eq .Lang $otherLang) }}
          {{ $otherBaseName := strings.TrimSuffix (printf ".%s" $otherLang) .File.LogicalName }}
          {{ $otherBaseName = strings.TrimSuffix ".md" $otherBaseName }}
          {{ if eq $otherBaseName $baseName }}
            {{ if isset .Params "description" }}
              {{ if and .Params.description (ne .Params.description "") }}
                {{ $description = .Params.description }}
                {{ break }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  
  {{ if and $description (ne $description "") }}
    <div class="f6 f5-ns lh-copy mb5 black-80" style="font-family: 'Inter', sans-serif; max-width: 800px;">
      {{ $description | markdownify }}
    </div>
  {{ end }}

  <!-- News Image -->
  {{ $newsImage := "" }}
  {{/* Always prioritize current language's content first */}}
  {{ if isset .Params "image" }}
    {{ if and .Params.image (ne .Params.image "") }}
      {{ $newsImage = .Params.image }}
    {{ end }}
  {{ end }}
  {{/* Only fallback to other language if current language has no image */}}
  {{ if or (not $newsImage) (eq $newsImage "") }}
    {{/* Try using Hugo's Translations feature first */}}
    {{ range .Translations }}
      {{ if isset .Params "image" }}
        {{ if and .Params.image (ne .Params.image "") }}
          {{ $newsImage = .Params.image }}
          {{ break }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{/* Fallback: manually find by matching filename */}}
    {{ if or (not $newsImage) (eq $newsImage "") }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{/* Extract base filename without language suffix */}}
      {{ $baseName := strings.TrimSuffix (printf ".%s" .Lang) .File.LogicalName }}
      {{ $baseName = strings.TrimSuffix ".md" $baseName }}
      {{/* Find the other language version by matching base filename */}}
      {{ range where $.Site.AllPages "Section" "latest" }}
        {{ if and .File (eq .Lang $otherLang) }}
          {{ $otherBaseName := strings.TrimSuffix (printf ".%s" $otherLang) .File.LogicalName }}
          {{ $otherBaseName = strings.TrimSuffix ".md" $otherBaseName }}
          {{ if eq $otherBaseName $baseName }}
            {{ if isset .Params "image" }}
              {{ if and .Params.image (ne .Params.image "") }}
                {{ $newsImage = .Params.image }}
                {{ break }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  
  {{ if and $newsImage (ne $newsImage "") }}
    <div class="mb5" style="max-width: 800px;">
      <img src="{{ $newsImage }}" alt="{{ .Title }}" class="w-100" style="max-width: 100%; height: auto; display: block;" />
    </div>
  {{ end }}

  <!-- Link Section -->
  {{ $linkType := "" }}
  {{ $internalLink := "" }}
  {{ $externalLink := "" }}
  {{/* Always prioritize current language's content first */}}
  {{ if isset .Params "link_type" }}
    {{ if and .Params.link_type (ne .Params.link_type "") }}
      {{ $linkType = .Params.link_type }}
    {{ end }}
  {{ end }}
  {{ if isset .Params "internal_link" }}
    {{ if and .Params.internal_link (ne .Params.internal_link "") }}
      {{ $internalLink = .Params.internal_link }}
    {{ end }}
  {{ end }}
  {{ if isset .Params "external_link" }}
    {{ if and .Params.external_link (ne .Params.external_link "") }}
      {{ $externalLink = .Params.external_link }}
    {{ end }}
  {{ end }}
  {{/* Only fallback to other language if current language has no link fields */}}
  {{ if or (not $linkType) (eq $linkType "") (not $internalLink) (eq $internalLink "") (not $externalLink) (eq $externalLink "") }}
    {{/* Try using Hugo's Translations feature first */}}
    {{ range .Translations }}
      {{ if isset .Params "link_type" }}
        {{ if and .Params.link_type (ne .Params.link_type "") (or (not $linkType) (eq $linkType "")) }}
          {{ $linkType = .Params.link_type }}
        {{ end }}
      {{ end }}
      {{ if isset .Params "internal_link" }}
        {{ if and .Params.internal_link (ne .Params.internal_link "") (or (not $internalLink) (eq $internalLink "")) }}
          {{ $internalLink = .Params.internal_link }}
        {{ end }}
      {{ end }}
      {{ if isset .Params "external_link" }}
        {{ if and .Params.external_link (ne .Params.external_link "") (or (not $externalLink) (eq $externalLink "")) }}
          {{ $externalLink = .Params.external_link }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{/* Fallback: manually find by matching filename */}}
    {{ if or (not $linkType) (eq $linkType "") (not $internalLink) (eq $internalLink "") (not $externalLink) (eq $externalLink "") }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{/* Extract base filename without language suffix */}}
      {{ $baseName := strings.TrimSuffix (printf ".%s" .Lang) .File.LogicalName }}
      {{ $baseName = strings.TrimSuffix ".md" $baseName }}
      {{/* Find the other language version by matching base filename */}}
      {{ range where $.Site.AllPages "Section" "latest" }}
        {{ if and .File (eq .Lang $otherLang) }}
          {{ $otherBaseName := strings.TrimSuffix (printf ".%s" $otherLang) .File.LogicalName }}
          {{ $otherBaseName = strings.TrimSuffix ".md" $otherBaseName }}
          {{ if eq $otherBaseName $baseName }}
            {{ if isset .Params "link_type" }}
              {{ if and .Params.link_type (ne .Params.link_type "") (or (not $linkType) (eq $linkType "")) }}
                {{ $linkType = .Params.link_type }}
              {{ end }}
            {{ end }}
            {{ if isset .Params "internal_link" }}
              {{ if and .Params.internal_link (ne .Params.internal_link "") (or (not $internalLink) (eq $internalLink "")) }}
                {{ $internalLink = .Params.internal_link }}
              {{ end }}
            {{ end }}
            {{ if isset .Params "external_link" }}
              {{ if and .Params.external_link (ne .Params.external_link "") (or (not $externalLink) (eq $externalLink "")) }}
                {{ $externalLink = .Params.external_link }}
              {{ end }}
            {{ end }}
            {{ break }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  
  {{ if or $internalLink $externalLink }}
    <div class="mt5 pt4 pb4" style="border-top: 1px solid #e5e5e5;">
      {{ $linkURL := "" }}
      {{ $isExternal := false }}
      
      {{ if eq $linkType "external" }}
        {{ $linkURL = $externalLink }}
        {{ $isExternal = true }}
      {{ else }}
        {{ $linkURL = $internalLink }}
        {{ if not (hasPrefix $linkURL "/") }}
          {{ $linkURL = printf "/%s" $linkURL }}
        {{ end }}
        {{ if eq $.Site.Language.Lang "de" }}
          {{ if not (hasPrefix $linkURL "/de/") }}
            {{ $linkURL = printf "/de%s" $linkURL }}
          {{ end }}
        {{ end }}
      {{ end }}
      
      {{ if $linkURL }}
        <a href="{{ $linkURL }}" 
           {{ if $isExternal }}target="_blank" rel="noopener noreferrer"{{ end }}
           class="dib bg-black white pa3 pa4-ns no-underline hover-bg-black-80" 
           style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em; transition: background-color 0.2s;">
          {{ if $isExternal }}VISIT LINK{{ else }}LEARN MORE{{ end }}
        </a>
      {{ end }}
    </div>
  {{ end }}

  <!-- Back to Latest News Link -->
  <div class="mt4 pt4" style="border-top: 1px solid #e5e5e5;">
    {{ $latestURL := "/latest/" }}
    {{ if eq .Site.Language.Lang "de" }}
      {{ $latestURL = "/de/latest/" }}
    {{ end }}
    <a href="{{ $latestURL }}" class="f6 f5-ns black-90 hover-black no-underline" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
      ← Back to Latest News
    </a>
  </div>

  <!-- Add padding at bottom -->
  <div class="pb6"></div>
</div>

<style>
  .news-item:hover {
    background-color: #f9f9f9;
  }
  
  .news-item:hover h3 {
    text-decoration: underline;
  }
</style>
{{ end }}

