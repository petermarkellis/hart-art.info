{{ define "header" }}
  <!-- Latest news pages - white background, no large header -->
  <header class="bg-white">
    {{ partial "site-navigation.html" . }}
  </header>
{{ end }}

{{ define "main" }}
<div class="ph2 pv4 ph4-ns pv5-ns bg-white" style="max-width: 800px; margin: 0 auto;">
  <!-- News Title -->
  <h1 class="f4 f3-ns fw6 mb4 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
    {{ .Title | upper }}
  </h1>

  {{/* Determine creation date, with fallbacks to other language */}}
  {{ $creationDate := .Date }}
  {{ if or (not $creationDate) $creationDate.IsZero }}
    {{ range .Translations }}
      {{ if not .Date.IsZero }}
        {{ $creationDate = .Date }}
        {{ break }}
      {{ end }}
    {{ end }}
  {{ end }}
  {{ if or (not $creationDate) $creationDate.IsZero }}
    {{ $otherLang := "en" }}
    {{ if eq .Site.Language.Lang "en" }}
      {{ $otherLang = "de" }}
    {{ end }}
    {{ if and $.File $.File.LogicalName }}
      {{ $baseName := strings.TrimSuffix (printf ".%s" .Lang) $.File.LogicalName }}
      {{ $baseName = strings.TrimSuffix ".md" $baseName }}
      {{ range where $.Site.AllPages "Section" "latest" }}
        {{ if and .File (eq .Lang $otherLang) }}
          {{ $otherBaseName := strings.TrimSuffix (printf ".%s" $otherLang) .File.LogicalName }}
          {{ $otherBaseName = strings.TrimSuffix ".md" $otherBaseName }}
          {{ if eq $otherBaseName $baseName }}
            {{ if not .Date.IsZero }}
              {{ $creationDate = .Date }}
              {{ break }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ if and $creationDate (not $creationDate.IsZero) }}
    <div class="f7 f6-ns mb2 black-60" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
      {{ $creationDate.Format "2 January 2006" | upper }}
    </div>
  {{ end }}

  {{/* Determine exhibition date, also fall back to other language if missing */}}
  {{ $exhibitionDateRaw := "" }}
  {{ if isset .Params "exhibition_date" }}
    {{ if .Params.exhibition_date }}
      {{ $exhibitionDateRaw = .Params.exhibition_date }}
    {{ end }}
  {{ end }}
  {{ if not $exhibitionDateRaw }}
    {{ range .Translations }}
      {{ if isset .Params "exhibition_date" }}
        {{ if .Params.exhibition_date }}
          {{ $exhibitionDateRaw = .Params.exhibition_date }}
          {{ break }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  {{ if not $exhibitionDateRaw }}
    {{ $otherLang := "en" }}
    {{ if eq .Site.Language.Lang "en" }}
      {{ $otherLang = "de" }}
    {{ end }}
    {{ if and $.File $.File.LogicalName }}
      {{ $baseName := strings.TrimSuffix (printf ".%s" .Lang) $.File.LogicalName }}
      {{ $baseName = strings.TrimSuffix ".md" $baseName }}
      {{ range where $.Site.AllPages "Section" "latest" }}
        {{ if and .File (eq .Lang $otherLang) }}
          {{ $otherBaseName := strings.TrimSuffix (printf ".%s" $otherLang) .File.LogicalName }}
          {{ $otherBaseName = strings.TrimSuffix ".md" $otherBaseName }}
          {{ if eq $otherBaseName $baseName }}
            {{ if isset .Params "exhibition_date" }}
              {{ if .Params.exhibition_date }}
                {{ $exhibitionDateRaw = .Params.exhibition_date }}
                {{ break }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ if $exhibitionDateRaw }}
    {{ $exhibitionDate := time $exhibitionDateRaw }}
    {{ if and $exhibitionDate (not $exhibitionDate.IsZero) }}
      <div class="f7 f6-ns mb4 black-60" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
        <strong>EXHIBITION DATE:</strong> {{ $exhibitionDate.Format "2 January 2006" | upper }}
      </div>
    {{ end }}
  {{ end }}

  <!-- News Description -->
  {{ $description := "" }}
  {{/* Always prioritize current language's content first */}}
  {{ if isset .Params "description" }}
    {{ if and .Params.description (ne .Params.description "") }}
      {{ $description = .Params.description }}
    {{ end }}
  {{ end }}
  {{/* Only fallback to other language if current language has no description */}}
  {{ if or (not $description) (eq $description "") }}
    {{/* Try using Hugo's Translations feature first */}}
    {{ range .Translations }}
      {{ if isset .Params "description" }}
        {{ if and .Params.description (ne .Params.description "") }}
          {{ $description = .Params.description }}
          {{ break }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{/* Fallback: manually find by matching filename */}}
    {{ if or (not $description) (eq $description "") }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{/* Extract base filename without language suffix */}}
      {{ $baseName := strings.TrimSuffix (printf ".%s" .Lang) .File.LogicalName }}
      {{ $baseName = strings.TrimSuffix ".md" $baseName }}
      {{/* Find the other language version by matching base filename */}}
      {{ range where $.Site.AllPages "Section" "latest" }}
        {{ if and .File (eq .Lang $otherLang) }}
          {{ $otherBaseName := strings.TrimSuffix (printf ".%s" $otherLang) .File.LogicalName }}
          {{ $otherBaseName = strings.TrimSuffix ".md" $otherBaseName }}
          {{ if eq $otherBaseName $baseName }}
            {{ if isset .Params "description" }}
              {{ if and .Params.description (ne .Params.description "") }}
                {{ $description = .Params.description }}
                {{ break }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  
  {{ if and $description (ne $description "") }}
    <div class="f6 f5-ns lh-copy mb5 black-80" style="font-family: 'Inter', sans-serif; max-width: 800px;">
      {{ $description | markdownify }}
    </div>
  {{ end }}

  <!-- News Image -->
  {{ $newsImage := "" }}
  {{/* Always prioritize current language's content first */}}
  {{ if isset .Params "image" }}
    {{ if and .Params.image (ne .Params.image "") }}
      {{ $newsImage = .Params.image }}
    {{ end }}
  {{ end }}
  {{/* Only fallback to other language if current language has no image */}}
  {{ if or (not $newsImage) (eq $newsImage "") }}
    {{/* Try using Hugo's Translations feature first */}}
    {{ range .Translations }}
      {{ if isset .Params "image" }}
        {{ if and .Params.image (ne .Params.image "") }}
          {{ $newsImage = .Params.image }}
          {{ break }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{/* Fallback: manually find by matching filename */}}
    {{ if or (not $newsImage) (eq $newsImage "") }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{/* Extract base filename without language suffix */}}
      {{ $baseName := strings.TrimSuffix (printf ".%s" .Lang) .File.LogicalName }}
      {{ $baseName = strings.TrimSuffix ".md" $baseName }}
      {{/* Find the other language version by matching base filename */}}
      {{ range where $.Site.AllPages "Section" "latest" }}
        {{ if and .File (eq .Lang $otherLang) }}
          {{ $otherBaseName := strings.TrimSuffix (printf ".%s" $otherLang) .File.LogicalName }}
          {{ $otherBaseName = strings.TrimSuffix ".md" $otherBaseName }}
          {{ if eq $otherBaseName $baseName }}
            {{ if isset .Params "image" }}
              {{ if and .Params.image (ne .Params.image "") }}
                {{ $newsImage = .Params.image }}
                {{ break }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  
  {{ if and $newsImage (ne $newsImage "") }}
    <div class="mb5" style="max-width: 800px;">
      <img src="{{ $newsImage }}" alt="{{ .Title }}" class="w-100" style="max-width: 100%; height: auto; display: block;" />
    </div>
  {{ end }}

  <!-- Link Section -->
  {{ $linkType := "" }}
  {{ $internalLink := "" }}
  {{ $externalLink := "" }}
  {{/* Always prioritize current language's content first */}}
  {{ if isset .Params "link_type" }}
    {{ if and .Params.link_type (ne .Params.link_type "") }}
      {{ $linkType = .Params.link_type }}
    {{ end }}
  {{ end }}
  {{ if isset .Params "internal_link" }}
    {{ if and .Params.internal_link (ne .Params.internal_link "") }}
      {{ $internalLink = .Params.internal_link }}
    {{ end }}
  {{ end }}
  {{ if isset .Params "external_link" }}
    {{ if and .Params.external_link (ne .Params.external_link "") }}
      {{ $externalLink = .Params.external_link }}
    {{ end }}
  {{ end }}
  {{/* Only fallback to other language if current language has no link fields */}}
  {{ if or (not $linkType) (eq $linkType "") (not $internalLink) (eq $internalLink "") (not $externalLink) (eq $externalLink "") }}
    {{/* Try using Hugo's Translations feature first */}}
    {{ range .Translations }}
      {{ if isset .Params "link_type" }}
        {{ if and .Params.link_type (ne .Params.link_type "") (or (not $linkType) (eq $linkType "")) }}
          {{ $linkType = .Params.link_type }}
        {{ end }}
      {{ end }}
      {{ if isset .Params "internal_link" }}
        {{ if and .Params.internal_link (ne .Params.internal_link "") (or (not $internalLink) (eq $internalLink "")) }}
          {{ $internalLink = .Params.internal_link }}
        {{ end }}
      {{ end }}
      {{ if isset .Params "external_link" }}
        {{ if and .Params.external_link (ne .Params.external_link "") (or (not $externalLink) (eq $externalLink "")) }}
          {{ $externalLink = .Params.external_link }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{/* Fallback: manually find by matching filename */}}
    {{ if or (not $linkType) (eq $linkType "") (not $internalLink) (eq $internalLink "") (not $externalLink) (eq $externalLink "") }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{/* Extract base filename without language suffix */}}
      {{ $baseName := strings.TrimSuffix (printf ".%s" .Lang) .File.LogicalName }}
      {{ $baseName = strings.TrimSuffix ".md" $baseName }}
      {{/* Find the other language version by matching base filename */}}
      {{ range where $.Site.AllPages "Section" "latest" }}
        {{ if and .File (eq .Lang $otherLang) }}
          {{ $otherBaseName := strings.TrimSuffix (printf ".%s" $otherLang) .File.LogicalName }}
          {{ $otherBaseName = strings.TrimSuffix ".md" $otherBaseName }}
          {{ if eq $otherBaseName $baseName }}
            {{ if isset .Params "link_type" }}
              {{ if and .Params.link_type (ne .Params.link_type "") (or (not $linkType) (eq $linkType "")) }}
                {{ $linkType = .Params.link_type }}
              {{ end }}
            {{ end }}
            {{ if isset .Params "internal_link" }}
              {{ if and .Params.internal_link (ne .Params.internal_link "") (or (not $internalLink) (eq $internalLink "")) }}
                {{ $internalLink = .Params.internal_link }}
              {{ end }}
            {{ end }}
            {{ if isset .Params "external_link" }}
              {{ if and .Params.external_link (ne .Params.external_link "") (or (not $externalLink) (eq $externalLink "")) }}
                {{ $externalLink = .Params.external_link }}
              {{ end }}
            {{ end }}
            {{ break }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  
  {{ if or $internalLink $externalLink }}
    <div class="mt5 pt4 pb4" style="border-top: 1px solid #e5e5e5;">
      {{ $linkURL := "" }}
      {{ $isExternal := false }}
      
      {{ if eq $linkType "external" }}
        {{ $linkURL = $externalLink }}
        {{ $isExternal = true }}
      {{ else }}
        {{ $linkURL = $internalLink }}
        {{ if not (hasPrefix $linkURL "/") }}
          {{ $linkURL = printf "/%s" $linkURL }}
        {{ end }}
        {{ if eq $.Site.Language.Lang "de" }}
          {{ if not (hasPrefix $linkURL "/de/") }}
            {{ $linkURL = printf "/de%s" $linkURL }}
          {{ end }}
        {{ end }}
      {{ end }}
      
      {{ if $linkURL }}
        <a href="{{ $linkURL }}" 
           {{ if $isExternal }}target="_blank" rel="noopener noreferrer"{{ end }}
           class="dib bg-black white pa3 pa4-ns no-underline hover-bg-black-80" 
           style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em; transition: background-color 0.2s;">
          {{ if $isExternal }}VISIT LINK{{ else }}LEARN MORE{{ end }}
        </a>
      {{ end }}
    </div>
  {{ end }}

  <!-- Back to Latest News Link -->
  <div class="mt4 pt4" style="border-top: 1px solid #e5e5e5;">
    {{ $latestURL := "/latest/" }}
    {{ if eq .Site.Language.Lang "de" }}
      {{ $latestURL = "/de/latest/" }}
    {{ end }}
    <a href="{{ $latestURL }}" class="f6 f5-ns black-90 hover-black no-underline" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
      ‚Üê Back to Latest News
    </a>
  </div>

  <!-- Add padding at bottom -->
  <div class="pb6"></div>
</div>

<style>
  .news-item:hover {
    background-color: #f9f9f9;
  }
  
  .news-item:hover h3 {
    text-decoration: underline;
  }
</style>
{{ end }}

