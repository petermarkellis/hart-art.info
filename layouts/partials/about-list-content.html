{{/* Get the about page for current language */}}
{{ $aboutPage := false }}
{{ $lang := .Site.Language.Lang }}

{{/* Get about section and find the page for current language */}}
{{ $aboutSection := .Site.GetPage "section" "about" }}
{{ if $aboutSection }}
  {{ range $aboutSection.Pages }}
    {{ if and (eq .Kind "page") (eq .Lang $lang) (not $aboutPage) }}
      {{ $aboutPage = . }}
    {{ end }}
  {{ end }}
  {{/* Fallback: if no language-specific page found, use any page from section */}}
  {{ if not $aboutPage }}
    {{ range $aboutSection.Pages }}
      {{ if and (eq .Kind "page") (not $aboutPage) }}
        {{ $aboutPage = . }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

{{/* Fallback to current context if page not found */}}
{{ if not $aboutPage }}
  {{ $aboutPage = . }}
{{ end }}

{{ $profileImage := $aboutPage.Params.image }}
{{ $defaultAboutPage := site.GetPage "page" "about/_index.md" }}
{{ if not $defaultAboutPage }}
  {{ $defaultAboutPage = site.GetPage "/about/_index.md" }}
{{ end }}
{{ if not $defaultAboutPage }}
  {{ range where .Site.AllPages "Section" "about" }}
    {{ if and (not $defaultAboutPage) (eq .File.LogicalName "_index.md") }}
      {{ $defaultAboutPage = . }}
    {{ end }}
  {{ end }}
{{ end }}

{{ $defaultAboutParams := dict }}
{{ $defaultFrontPath := "content/about/_index.md" }}
{{ if fileExists $defaultFrontPath }}
  {{ $raw := readFile $defaultFrontPath }}
  {{ $front := replaceRE `(?s)^---\s*\n(.*?)\n---.*$` "$1" $raw }}
  {{ $defaultAboutParams = $front | transform.Unmarshal }}
{{ end }}

{{/* If current language has no image or image is empty, try to get from the other language version */}}
{{ if not $profileImage }}
  {{ $otherLang := "en" }}
  {{ if eq .Site.Language.Lang "en" }}
    {{ $otherLang = "de" }}
  {{ end }}
  {{ $otherLangPage := false }}
  {{ range where .Site.AllPages "Section" "about" }}
    {{ if and (eq .Kind "page") (eq .Lang $otherLang) }}
      {{ $otherLangPage = . }}
    {{ end }}
  {{ end }}
  {{ if and $otherLangPage $otherLangPage.Params.image }}
    {{ $profileImage = $otherLangPage.Params.image }}
  {{ end }}
{{ end }}

{{/* Also check if the image file exists - if not, use the other language's image */}}
{{ if $profileImage }}
  {{ $imageExists := false }}
  {{ $imagePath := strings.TrimPrefix "/" $profileImage }}
  {{ $imagePath = strings.TrimPrefix "images/" $imagePath }}
  {{ $imagePath = printf "static/images/%s" $imagePath }}
  {{ if fileExists $imagePath }}
    {{ $imageExists = true }}
  {{ end }}
  
  {{ if not $imageExists }}
    {{ $otherLang := "en" }}
    {{ if eq .Site.Language.Lang "en" }}
      {{ $otherLang = "de" }}
    {{ end }}
    {{ $otherLangPage := false }}
    {{ range where .Site.AllPages "Section" "about" }}
      {{ if and (eq .Kind "page") (eq .Lang $otherLang) }}
        {{ $otherLangPage = . }}
      {{ end }}
    {{ end }}
    {{ if and $otherLangPage $otherLangPage.Params.image }}
      {{ $profileImage = $otherLangPage.Params.image }}
    {{ end }}
  {{ end }}
{{ end }}

<div class="flex flex-column flex-row-l bg-white about-page-container" style="width: 100%;">
  <!-- Left Column - Portrait and Contact Info -->
  <aside class="w-100 w-40-l pa3 pa4-l bg-white about-sidebar" style="border-right: 1px solid #e5e5e5;">
    {{ if $profileImage }}
      <div class="mb4">
        <img src="{{ $profileImage }}" alt="{{ $aboutPage.Title }}" class="w-100" style="max-width: 100%; height: auto; display: block;" />
      </div>
    {{ end }}

    <div class="f6 f5-ns lh-copy black-80 mb4" style="font-family: 'Inter', sans-serif;">
      {{/* Support both nested contact_info object and flat structure for backward compatibility */}}
      {{ $contactInfo := $aboutPage.Params.contact_info }}
      {{/* If language-specific page doesn't have nested structure, check default _index.md */}}
      {{ if not $contactInfo }}
        {{ if $defaultAboutParams }}
          {{ if $defaultAboutParams.contact_info }}
            {{ $contactInfo = $defaultAboutParams.contact_info }}
          {{ end }}
        {{ end }}
      {{ end }}
      
      {{ $email := "" }}
      {{ $addressLine1 := "" }}
      {{ $addressLine2 := "" }}
      {{ $addressLine3 := "" }}
      {{ $contactButtonText := "" }}
      {{ $copyrightText := "" }}
      
      {{ if $contactInfo }}
        {{ $email = $contactInfo.email }}
        {{ $addressLine1 = $contactInfo.address_line1 }}
        {{ $addressLine2 = $contactInfo.address_line2 }}
        {{ $addressLine3 = $contactInfo.address_line3 }}
        {{ $contactButtonText = $contactInfo.contact_button_text }}
        {{ $copyrightText = $contactInfo.copyright_text }}
      {{ else }}
        {{/* Fallback to flat structure from language-specific page or default */}}
        {{ $email = $aboutPage.Params.email }}
        {{ $addressLine1 = $aboutPage.Params.address_line1 }}
        {{ $addressLine2 = $aboutPage.Params.address_line2 }}
        {{ $addressLine3 = $aboutPage.Params.address_line3 }}
        {{ $contactButtonText = $aboutPage.Params.contact_button_text }}
        {{ $copyrightText = $aboutPage.Params.copyright_text }}
        {{/* If still empty, try default file */}}
        {{ if and (not $email) $defaultAboutParams }}
          {{ $email = $defaultAboutParams.email }}
        {{ end }}
        {{ if and (not $addressLine1) $defaultAboutParams }}
          {{ $addressLine1 = $defaultAboutParams.address_line1 }}
        {{ end }}
        {{ if and (not $addressLine2) $defaultAboutParams }}
          {{ $addressLine2 = $defaultAboutParams.address_line2 }}
        {{ end }}
        {{ if and (not $addressLine3) $defaultAboutParams }}
          {{ $addressLine3 = $defaultAboutParams.address_line3 }}
        {{ end }}
        {{ if and (not $contactButtonText) $defaultAboutParams }}
          {{ $contactButtonText = $defaultAboutParams.contact_button_text }}
        {{ end }}
        {{ if and (not $copyrightText) $defaultAboutParams }}
          {{ $copyrightText = $defaultAboutParams.copyright_text }}
        {{ end }}
      {{ end }}
      
      {{ with $addressLine1 }}<p class="mb0">{{ . }}</p>{{ end }}
      {{ with $addressLine2 }}<p class="mb0">{{ . }}</p>{{ end }}
      {{ with $addressLine3 }}<p class="mb0">{{ . }}</p>{{ end }}
      <p class="mt3 mb0">
        {{ if $copyrightText }}
          {{ $copyrightText }}
        {{ else }}
          Â© {{ now.Format "2006" }} Mark Hartzheim
        {{ end }}
      </p>
    </div>

    {{ if $email }}
      <a href="mailto:{{ $email }}" class="dib bg-black white pa3 pa4-ns no-underline hover-bg-black-80 nav-link" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em; transition: background-color 0.2s;">
        {{ $contactButtonText | default "CONTACT THE ARTIST" }}
      </a>
    {{ end }}
  </aside>

  <!-- Right Column - About Content -->
  <div class="w-100 w-60-l pa3 pa4-l bg-white pb6 about-content" style="flex: 1;">
    <h1 class="f4 f3-ns fw6 mb4 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
      {{ $aboutPage.Title | upper }}
    </h1>

    {{/* Description/Content - language-specific */}}
    {{ $currentLang := .Site.Language.Lang }}
    {{ $description := "" }}
    
    {{/* Get language-specific description */}}
    {{ if eq $currentLang "de" }}
      {{ $description = $aboutPage.Params.body_de }}
    {{ else }}
      {{ $description = $aboutPage.Params.body_en }}
    {{ end }}
    
    {{/* Fallback to default file if not found in language-specific page */}}
    {{ if $defaultAboutParams }}
      {{ if not $description }}
        {{ if eq $currentLang "de" }}
          {{ $description = $defaultAboutParams.body_de }}
        {{ else }}
          {{ $description = $defaultAboutParams.body_en }}
        {{ end }}
      {{ end }}
    {{ end }}
    
    {{/* Fallback to Content if language-specific fields are empty (for backward compatibility) */}}
    {{ $useContentFallback := false }}
    {{ if not $description }}
      {{ $description = $aboutPage.Content }}
      {{ $useContentFallback = true }}
    {{ end }}
    
    {{ if $description }}
      <div class="f6 f5-ns lh-copy black-80 mb5" style="font-family: 'Inter', sans-serif; max-width: 800px;">
        {{ if $useContentFallback }}
          {{ $description }}
        {{ else }}
          {{ $description | markdownify }}
        {{ end }}
      </div>
    {{ end }}

    {{/* Buying Art and Commissioning Section */}}
    {{ $showBuyingArt := $aboutPage.Params.show_buying_art }}
    {{ if not (isset $aboutPage.Params "show_buying_art") }}
      {{ $showBuyingArt = true }}
    {{ end }}
    {{ if $defaultAboutParams }}
      {{ if not (isset $aboutPage.Params "show_buying_art") }}
        {{ if isset $defaultAboutParams "show_buying_art" }}
          {{ $showBuyingArt = $defaultAboutParams.show_buying_art }}
        {{ end }}
      {{ end }}
    {{ end }}
    
    {{ if $showBuyingArt }}
      {{ $currentLang := .Site.Language.Lang }}
      {{ $buyingArtTitle := "" }}
      {{ $buyingArtDescription := "" }}
      
      {{/* Get language-specific fields */}}
      {{ if eq $currentLang "de" }}
        {{ $buyingArtTitle = $aboutPage.Params.buying_art_title_de }}
        {{ $buyingArtDescription = $aboutPage.Params.buying_art_description_de }}
      {{ else }}
        {{ $buyingArtTitle = $aboutPage.Params.buying_art_title_en }}
        {{ $buyingArtDescription = $aboutPage.Params.buying_art_description_en }}
      {{ end }}
      
      {{/* Fallback to default file if not found in language-specific page */}}
      {{ if $defaultAboutParams }}
        {{ if not $buyingArtTitle }}
          {{ if eq $currentLang "de" }}
            {{ $buyingArtTitle = $defaultAboutParams.buying_art_title_de }}
          {{ else }}
            {{ $buyingArtTitle = $defaultAboutParams.buying_art_title_en }}
          {{ end }}
        {{ end }}
        {{ if not $buyingArtDescription }}
          {{ if eq $currentLang "de" }}
            {{ $buyingArtDescription = $defaultAboutParams.buying_art_description_de }}
          {{ else }}
            {{ $buyingArtDescription = $defaultAboutParams.buying_art_description_en }}
          {{ end }}
        {{ end }}
      {{ end }}
      
      {{ if or $buyingArtTitle $buyingArtDescription }}
        <div class="f6 f5-ns lh-copy black-80 mb5" style="font-family: 'Inter', sans-serif; max-width: 800px;">
          {{ if $buyingArtTitle }}
            <h2 class="f5 f4-ns fw6 mb3 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
              {{ $buyingArtTitle | upper }}
            </h2>
          {{ end }}
          {{ if $buyingArtDescription }}
            <div class="mb4">
              {{ $buyingArtDescription | markdownify }}
            </div>
          {{ end }}
        </div>
      {{ end }}
    {{ end }}

    {{/* Curriculum Vitae Section */}}
{{/* Try multiple ways to access CV entries for i18n compatibility */}}
{{ $cvEntries := $aboutPage.Params.curriculum_vitae }}
    {{ if not $cvEntries }}
      {{ $cvEntries = .Params.curriculum_vitae }}
    {{ end }}
{{ if not $cvEntries }}
  {{ range $aboutPage.Translations }}
    {{ if .Params.curriculum_vitae }}
      {{ $cvEntries = .Params.curriculum_vitae }}
      {{ break }}
    {{ end }}
  {{ end }}
{{ end }}
{{ if and (not $cvEntries) (gt (len $defaultAboutParams) 0) }}
  {{ with index $defaultAboutParams "curriculum_vitae" }}
    {{ $cvEntries = . }}
  {{ end }}
{{ end }}
    {{ if not $cvEntries }}
      {{/* Try getting from the first page in the about section */}}
      {{ range first 1 (where .Site.AllPages "Section" "about") }}
        {{ if .Params.curriculum_vitae }}
          {{ $cvEntries = .Params.curriculum_vitae }}
        {{ end }}
      {{ end }}
    {{ end }}
{{ if and (not $cvEntries) $defaultAboutPage }}
  {{ if $defaultAboutPage.Params.curriculum_vitae }}
    {{ $cvEntries = $defaultAboutPage.Params.curriculum_vitae }}
  {{ end }}
{{ end }}
    {{/* If current language has no CV entries, try to get from the other language version */}}
    {{ if not $cvEntries }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{ $otherLangPage := false }}
      {{ range where .Site.AllPages "Section" "about" }}
        {{ if and (eq .Kind "page") (eq .Lang $otherLang) }}
          {{ $otherLangPage = . }}
        {{ end }}
      {{ end }}
      {{ if and $otherLangPage $otherLangPage.Params.curriculum_vitae }}
        {{ $cvEntries = $otherLangPage.Params.curriculum_vitae }}
      {{ end }}
    {{ end }}

    {{/* Curriculum section title */}}
    {{ $cvTitle := "" }}
    {{ if eq .Site.Language.Lang "de" }}
      {{ $cvTitle = $aboutPage.Params.curriculum_title_de }}
      {{ if not $cvTitle }}
        {{ $cvTitle = .Params.curriculum_title_de }}
      {{ end }}
    {{ else }}
      {{ $cvTitle = $aboutPage.Params.curriculum_title_en }}
      {{ if not $cvTitle }}
        {{ $cvTitle = .Params.curriculum_title_en }}
      {{ end }}
    {{ end }}
{{ if not $cvTitle }}
  {{ range $aboutPage.Translations }}
    {{ if eq $.Site.Language.Lang "de" }}
      {{ if .Params.curriculum_title_de }}
        {{ $cvTitle = .Params.curriculum_title_de }}
      {{ end }}
    {{ else }}
      {{ if .Params.curriculum_title_en }}
        {{ $cvTitle = .Params.curriculum_title_en }}
      {{ end }}
    {{ end }}
    {{ if $cvTitle }}
      {{ break }}
    {{ end }}
  {{ end }}
{{ end }}
{{ if not $cvTitle }}
  {{ if and $defaultAboutPage (eq .Site.Language.Lang "de") }}
    {{ $cvTitle = $defaultAboutPage.Params.curriculum_title_de }}
  {{ else if $defaultAboutPage }}
    {{ $cvTitle = $defaultAboutPage.Params.curriculum_title_en }}
  {{ end }}
{{ end }}
{{ if not $cvTitle }}
  {{ if eq .Site.Language.Lang "de" }}
    {{ with index $defaultAboutParams "curriculum_title_de" }}
      {{ $cvTitle = . }}
    {{ end }}
  {{ else }}
    {{ with index $defaultAboutParams "curriculum_title_en" }}
      {{ $cvTitle = . }}
    {{ end }}
  {{ end }}
{{ end }}
{{ if not $cvTitle }}
      {{ range first 1 (where .Site.AllPages "Section" "about") }}
        {{ if .Params.curriculum_title }}
          {{ $cvTitle = .Params.curriculum_title }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{ if not $cvTitle }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{ $otherLangCurriculum := false }}
      {{ range where .Site.AllPages "Section" "about" }}
        {{ if and (eq .Kind "page") (eq .Lang $otherLang) }}
          {{ $otherLangCurriculum = . }}
        {{ end }}
      {{ end }}
      {{ if and $otherLangCurriculum (eq .Site.Language.Lang "de") }}
        {{ $cvTitle = $otherLangCurriculum.Params.curriculum_title_de }}
      {{ else if and $otherLangCurriculum }}
        {{ $cvTitle = $otherLangCurriculum.Params.curriculum_title_en }}
      {{ end }}
    {{ end }}
    {{ if not $cvTitle }}
      {{ if eq .Site.Language.Lang "de" }}
        {{ $cvTitle = "CURRICULUM VITAE" }}
      {{ else }}
        {{ $cvTitle = "CURRICULUM VITAE" }}
      {{ end }}
    {{ end }}

    {{ if $cvEntries }}
      <div class="mb5" style="max-width: 800px;">
        <h2 class="f5 f4-ns fw6 mb4 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
          {{ $cvTitle | upper }}
        </h2>
        <div class="f6 f5-ns lh-copy black-80" style="font-family: 'Inter', sans-serif;">
          {{ range $cvEntries }}
            <div class="mb3">
              {{/* Build year range */}}
              {{ $yearRange := "" }}
              {{ if .from_year }}
                {{ if .to_year }}
                  {{ $yearRange = printf "%s-%s" .from_year .to_year }}
                {{ else }}
                  {{ $yearRange = .from_year }}
                {{ end }}
              {{ else if .to_year }}
                {{ $yearRange = .to_year }}
              {{ end }}
              
              {{/* Get text in current language */}}
              {{ $text := "" }}
              {{ $currentLang := $.Site.Language.Lang }}
              {{ if eq $currentLang "de" }}
                {{ $text = .text_de | default .text_en | default "" }}
              {{ else }}
                {{ $text = .text_en | default .text_de | default "" }}
              {{ end }}
              
              <div class="cv-entry">
                {{ if $yearRange }}
                  <span class="cv-year fw6">{{ $yearRange }}</span>
                {{ end }}
                {{ if $text }}
                  <span class="cv-text">{{ $text }}</span>
                {{ end }}
              </div>
            </div>
          {{ end }}
        </div>
      </div>
    {{ end }}

    {{/* Other Qualifications Section */}}
{{/* Try multiple ways to access qualifications for i18n compatibility */}}
{{ $qualifications := $aboutPage.Params.other_qualifications }}
    {{ if not $qualifications }}
      {{ $qualifications = .Params.other_qualifications }}
    {{ end }}
{{ if not $qualifications }}
  {{ range $aboutPage.Translations }}
    {{ if .Params.other_qualifications }}
      {{ $qualifications = .Params.other_qualifications }}
      {{ break }}
    {{ end }}
  {{ end }}
{{ end }}
{{ if and (not $qualifications) (gt (len $defaultAboutParams) 0) }}
  {{ with index $defaultAboutParams "other_qualifications" }}
    {{ $qualifications = . }}
  {{ end }}
{{ end }}
    {{ if not $qualifications }}
      {{/* Try getting from the first page in the about section */}}
      {{ range first 1 (where .Site.AllPages "Section" "about") }}
        {{ if .Params.other_qualifications }}
          {{ $qualifications = .Params.other_qualifications }}
        {{ end }}
      {{ end }}
    {{ end }}
{{ if and (not $qualifications) $defaultAboutPage }}
  {{ if $defaultAboutPage.Params.other_qualifications }}
    {{ $qualifications = $defaultAboutPage.Params.other_qualifications }}
  {{ end }}
{{ end }}
    {{/* If current language has no qualifications, try to get from the other language version */}}
    {{ if not $qualifications }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{ $otherLangPage := false }}
      {{ range where .Site.AllPages "Section" "about" }}
        {{ if and (eq .Kind "page") (eq .Lang $otherLang) }}
          {{ $otherLangPage = . }}
        {{ end }}
      {{ end }}
      {{ if and $otherLangPage $otherLangPage.Params.other_qualifications }}
        {{ $qualifications = $otherLangPage.Params.other_qualifications }}
      {{ end }}
    {{ end }}

    {{/* Other Qualifications section title */}}
    {{ $qualificationsTitle := "" }}
    {{ if eq .Site.Language.Lang "de" }}
      {{ $qualificationsTitle = $aboutPage.Params.qualifications_title_de }}
      {{ if not $qualificationsTitle }}
        {{ $qualificationsTitle = .Params.qualifications_title_de }}
      {{ end }}
    {{ else }}
      {{ $qualificationsTitle = $aboutPage.Params.qualifications_title_en }}
      {{ if not $qualificationsTitle }}
        {{ $qualificationsTitle = .Params.qualifications_title_en }}
      {{ end }}
    {{ end }}
{{ if not $qualificationsTitle }}
  {{ range $aboutPage.Translations }}
    {{ if eq $.Site.Language.Lang "de" }}
      {{ if .Params.qualifications_title_de }}
        {{ $qualificationsTitle = .Params.qualifications_title_de }}
      {{ end }}
    {{ else }}
      {{ if .Params.qualifications_title_en }}
        {{ $qualificationsTitle = .Params.qualifications_title_en }}
      {{ end }}
    {{ end }}
    {{ if $qualificationsTitle }}
      {{ break }}
    {{ end }}
  {{ end }}
{{ end }}
{{ if not $qualificationsTitle }}
  {{ if and $defaultAboutPage (eq .Site.Language.Lang "de") }}
    {{ $qualificationsTitle = $defaultAboutPage.Params.qualifications_title_de }}
  {{ else if $defaultAboutPage }}
    {{ $qualificationsTitle = $defaultAboutPage.Params.qualifications_title_en }}
  {{ end }}
{{ end }}
{{ if not $qualificationsTitle }}
  {{ if eq .Site.Language.Lang "de" }}
    {{ with index $defaultAboutParams "qualifications_title_de" }}
      {{ $qualificationsTitle = . }}
    {{ end }}
  {{ else }}
    {{ with index $defaultAboutParams "qualifications_title_en" }}
      {{ $qualificationsTitle = . }}
    {{ end }}
  {{ end }}
{{ end }}
{{ if not $qualificationsTitle }}
      {{ range first 1 (where .Site.AllPages "Section" "about") }}
        {{ if .Params.qualifications_title }}
          {{ $qualificationsTitle = .Params.qualifications_title }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{ if not $qualificationsTitle }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{ $otherLangQual := false }}
      {{ range where .Site.AllPages "Section" "about" }}
        {{ if and (eq .Kind "page") (eq .Lang $otherLang) }}
          {{ $otherLangQual = . }}
        {{ end }}
      {{ end }}
      {{ if and $otherLangQual (eq .Site.Language.Lang "de") }}
        {{ $qualificationsTitle = $otherLangQual.Params.qualifications_title_de }}
      {{ else if and $otherLangQual }}
        {{ $qualificationsTitle = $otherLangQual.Params.qualifications_title_en }}
      {{ end }}
    {{ end }}
    {{ if not $qualificationsTitle }}
      {{ if eq .Site.Language.Lang "de" }}
        {{ $qualificationsTitle = "WEITERE QUALIFIKATIONEN" }}
      {{ else }}
        {{ $qualificationsTitle = "OTHER QUALIFICATIONS" }}
      {{ end }}
    {{ end }}

    {{ if $qualifications }}
      <div class="mb5" style="max-width: 800px;">
        <h2 class="f5 f4-ns fw6 mb4 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
          {{ $qualificationsTitle | upper }}
        </h2>
        <div class="f6 f5-ns lh-copy black-80" style="font-family: 'Inter', sans-serif;">
          {{ range $qualifications }}
            {{/* Get text in current language */}}
            {{ $text := "" }}
            {{ $currentLang := $.Site.Language.Lang }}
            {{ if eq $currentLang "de" }}
              {{ $text = .text_de | default .text_en | default "" }}
            {{ else }}
              {{ $text = .text_en | default .text_de | default "" }}
            {{ end }}
            
            {{ if $text }}
              <div class="mb3">
                {{ $text }}
              </div>
            {{ end }}
          {{ end }}
        </div>
      </div>
    {{ end }}

    {{/* Exhibits Section */}}
{{ $exhibits := $aboutPage.Params.exhibits }}
    {{ if not $exhibits }}
      {{ $exhibits = .Params.exhibits }}
    {{ end }}
{{ if not $exhibits }}
  {{ range $aboutPage.Translations }}
    {{ if .Params.exhibits }}
      {{ $exhibits = .Params.exhibits }}
      {{ break }}
    {{ end }}
  {{ end }}
{{ end }}
{{ if and (not $exhibits) (gt (len $defaultAboutParams) 0) }}
  {{ with index $defaultAboutParams "exhibits" }}
    {{ $exhibits = . }}
  {{ end }}
{{ end }}
    {{ if not $exhibits }}
      {{ range first 1 (where .Site.AllPages "Section" "about") }}
        {{ if .Params.exhibits }}
          {{ $exhibits = .Params.exhibits }}
        {{ end }}
      {{ end }}
    {{ end }}
{{ if and (not $exhibits) $defaultAboutPage }}
  {{ if $defaultAboutPage.Params.exhibits }}
    {{ $exhibits = $defaultAboutPage.Params.exhibits }}
  {{ end }}
{{ end }}
    {{ if not $exhibits }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{ $otherLangPage := false }}
      {{ range where .Site.AllPages "Section" "about" }}
        {{ if and (eq .Kind "page") (eq .Lang $otherLang) }}
          {{ $otherLangPage = . }}
        {{ end }}
      {{ end }}
      {{ if and $otherLangPage $otherLangPage.Params.exhibits }}
        {{ $exhibits = $otherLangPage.Params.exhibits }}
      {{ end }}
    {{ end }}

    {{/* Exhibits section title */}}
    {{ $exhibitsTitle := "" }}
    {{ if eq .Site.Language.Lang "de" }}
      {{ $exhibitsTitle = $aboutPage.Params.exhibits_title_de }}
      {{ if not $exhibitsTitle }}
        {{ $exhibitsTitle = .Params.exhibits_title_de }}
      {{ end }}
    {{ else }}
      {{ $exhibitsTitle = $aboutPage.Params.exhibits_title_en }}
      {{ if not $exhibitsTitle }}
        {{ $exhibitsTitle = .Params.exhibits_title_en }}
      {{ end }}
    {{ end }}
{{ if not $exhibitsTitle }}
  {{ range $aboutPage.Translations }}
    {{ if eq $.Site.Language.Lang "de" }}
      {{ if .Params.exhibits_title_de }}
        {{ $exhibitsTitle = .Params.exhibits_title_de }}
      {{ end }}
    {{ else }}
      {{ if .Params.exhibits_title_en }}
        {{ $exhibitsTitle = .Params.exhibits_title_en }}
      {{ end }}
    {{ end }}
    {{ if $exhibitsTitle }}
      {{ break }}
    {{ end }}
  {{ end }}
{{ end }}
{{ if not $exhibitsTitle }}
  {{ if and $defaultAboutPage (eq .Site.Language.Lang "de") }}
    {{ $exhibitsTitle = $defaultAboutPage.Params.exhibits_title_de }}
  {{ else if $defaultAboutPage }}
    {{ $exhibitsTitle = $defaultAboutPage.Params.exhibits_title_en }}
  {{ end }}
{{ end }}
{{ if not $exhibitsTitle }}
  {{ if eq .Site.Language.Lang "de" }}
    {{ with index $defaultAboutParams "exhibits_title_de" }}
      {{ $exhibitsTitle = . }}
    {{ end }}
  {{ else }}
    {{ with index $defaultAboutParams "exhibits_title_en" }}
      {{ $exhibitsTitle = . }}
    {{ end }}
  {{ end }}
{{ end }}
{{ if not $exhibitsTitle }}
      {{ range first 1 (where .Site.AllPages "Section" "about") }}
        {{ if .Params.exhibits_title }}
          {{ $exhibitsTitle = .Params.exhibits_title }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{ if not $exhibitsTitle }}
      {{ $otherLang := "en" }}
      {{ if eq .Site.Language.Lang "en" }}
        {{ $otherLang = "de" }}
      {{ end }}
      {{ $otherLangExhibits := false }}
      {{ range where .Site.AllPages "Section" "about" }}
        {{ if and (eq .Kind "page") (eq .Lang $otherLang) }}
          {{ $otherLangExhibits = . }}
        {{ end }}
      {{ end }}
      {{ if and $otherLangExhibits (eq .Site.Language.Lang "de") }}
        {{ $exhibitsTitle = $otherLangExhibits.Params.exhibits_title_de }}
      {{ else if and $otherLangExhibits }}
        {{ $exhibitsTitle = $otherLangExhibits.Params.exhibits_title_en }}
      {{ end }}
    {{ end }}
    {{ if not $exhibitsTitle }}
      {{ if eq .Site.Language.Lang "de" }}
        {{ $exhibitsTitle = "AUSSTELLUNGEN" }}
      {{ else }}
        {{ $exhibitsTitle = "EXHIBITS" }}
      {{ end }}
    {{ end }}

    {{ if $exhibits }}
      <div class="mb5" style="max-width: 800px;">
        <h2 class="f5 f4-ns fw6 mb4 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">
          {{ $exhibitsTitle | upper }}
        </h2>
        <div class="f6 f5-ns lh-copy black-80" style="font-family: 'Inter', sans-serif;">
          {{ range $exhibits }}
            {{ $text := "" }}
            {{ $currentLang := $.Site.Language.Lang }}
            {{ if eq $currentLang "de" }}
              {{ $text = .text_de | default .text_en | default "" }}
            {{ else }}
              {{ $text = .text_en | default .text_de | default "" }}
            {{ end }}
            {{ if or .year $text }}
              <div class="mb3">
                <div class="exhibit-entry">
                  {{ if .year }}
                    <span class="exhibit-year fw6">{{ .year }}</span>
                  {{ end }}
                  {{ if $text }}
                    <span class="exhibit-text">{{ $text }}</span>
                  {{ end }}
                </div>
              </div>
            {{ end }}
          {{ end }}
        </div>
      </div>
    {{ end }}
  </main>
</div>

<style>
  /* Force main to not have overflow on about page - use highest specificity */
  body main[role="main"] {
    overflow: visible !important;
    overflow-x: visible !important;
    overflow-y: visible !important;
  }
  
  /* About page layout on desktop */
  @media (min-width: 60em) {
    .about-page-container {
      align-items: stretch !important;
      display: flex !important;
    }
    
    .about-sidebar {
      align-self: stretch !important;
      /* Remove height constraints - let flexbox stretch it to match sibling */
    }
  }
  
  /* Responsive layout for about page */
  @media (max-width: 60em) {
    .about-sidebar {
      border-right: none !important;
      border-bottom: 1px solid #e5e5e5;
      position: relative !important;
      align-self: stretch !important;
      max-height: none !important;
      overflow-y: visible !important;
    }
  }

    .cv-entry,
    .exhibit-entry {
      display: block !important;
    }

    .cv-year,
    .cv-text,
    .exhibit-year,
    .exhibit-text {
      display: block;
    }
  }

  @media (min-width: 60em) {
    .cv-entry,
    .exhibit-entry {
      display: inline;
    }
  }
</style>

