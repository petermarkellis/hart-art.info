<section class="pa4 pa5-ns bg-white">
  <h1 class="f6 f5-ns fw6 mb4 black-90" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em;">LATEST NEWS</h1>
  <div class="news-list">
    {{/* Get latest news pages for current language */}}
    {{ $currentLang := .Site.Language.Lang }}
    {{ $latestNews := where .Site.RegularPages "Section" "latest" }}
    {{ $latestNews = where $latestNews "Lang" $currentLang }}
    {{ $latestNews = where $latestNews "IsNode" false }}
    {{ $latestNews = $latestNews.ByDate.Reverse }}
    {{ range $latestNews }}
      {{ $newsItem := . }}
      {{/* Get date: exhibition_date (preferred) or date from current file */}}
      {{ $displayDate := "" }}
      {{/* Check exhibition_date in current file first - if it exists and is valid, use it */}}
      {{ if isset $newsItem.Params "exhibition_date" }}
        {{ if $newsItem.Params.exhibition_date }}
          {{ $parsedExhibitionDate := time $newsItem.Params.exhibition_date }}
          {{/* Only use if successfully parsed (not zero date) */}}
          {{ if and $parsedExhibitionDate (not $parsedExhibitionDate.IsZero) }}
            {{ $displayDate = $parsedExhibitionDate }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{/* If no exhibition_date or it's invalid, use date from current file */}}
      {{ if or (not $displayDate) $displayDate.IsZero }}
        {{ if isset $newsItem.Params "date" }}
          {{ if $newsItem.Params.date }}
            {{ $displayDate = time $newsItem.Params.date }}
          {{ end }}
        {{ end }}
        {{/* Final fallback to Hugo's Date field */}}
        {{ if or (not $displayDate) $displayDate.IsZero }}
          {{ if not $newsItem.Date.IsZero }}
            {{ $displayDate = $newsItem.Date }}
          {{ end }}
        {{ end }}
      {{ end }}
      <a href="{{ $newsItem.RelPermalink }}" class="db no-underline news-item" style="border-bottom: 1px solid #e5e5e5; padding: 1rem; display: flex; justify-content: space-between; align-items: center;">
        <div class="flex-auto">
          <h3 class="f6 f5-ns fw4 black-90 mb0" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em; margin: 0;">{{ $newsItem.Title }}</h3>
        </div>
        {{ if and $displayDate (not $displayDate.IsZero) }}
          <div class="ml3 ml4-ns" style="flex-shrink: 0;">
            <span class="f7 f6-ns black-60" style="font-family: 'Inter', sans-serif; letter-spacing: 0.05em; white-space: nowrap;">
              {{ $displayDate.Format "2 January 2006" | upper }}
            </span>
          </div>
        {{ end }}
      </a>
    {{ end }}
    {{ if not $latestNews }}
      <p class="f6 f5-ns black-70" style="font-family: 'Inter', sans-serif;">No news items yet.</p>
    {{ end }}
  </div>
</section>

<style>
  .news-item:hover {
    background-color: #fafafa;
  }
  
  /* Stack news items vertically on mobile */
  @media (max-width: 30em) {
    .news-item {
      flex-direction: column !important;
      align-items: flex-start !important;
      padding-left: 0 !important;
      padding-right: 0 !important;
    }
    .news-item .ml3 {
      margin-left: 0 !important;
      margin-top: 0.5rem;
    }
  }
</style>

